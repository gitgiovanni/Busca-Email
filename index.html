<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Busca EMAIL</title>
    <link rel="stylesheet" href="styles.css"> <!-- Certifique-se de que o CSS está correto -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>

    <!-- Conteúdo Principal -->
    <div class="site-content active" id="siteContent">
        <img src="https://fluig.andra.com.br/volume/stream/Rmx1aWc=/P3Q9MSZ2b2w9RGVmYXVsdCZpZD0xNzAxJnZlcj0xMDAwJmZpbGU9YW5kcmEtbG9nbyslMjgxJTI5LnBuZyZjcmM9NDIyMDg2NDE1OCZzaXplPTAuMDA2MDY3JnVJZD0yNSZmU0lkPTEmdVNJZD0xJmQ9ZmFsc2UmdGtuPSZwdWJsaWNVcmw9dHJ1ZSZhdHRhY2g9ZmFsc2U=.png" 
             alt="Logo" class="logo">
        <input type="text" id="cpf" class="search-box" placeholder="Digite seu CPF" maxlength="14" oninput="mascaraCPF(this)" required>
        <div class="email-output">Seu email é: <span id="emailDisplay"></span></div>
        <div class="spinner" id="spinner" style="display: none;"></div>
    </div>

    <!-- JavaScript -->
    <script>

        let emailBuscado = false; // Estado para controlar se a busca do email já foi feita

// Máscara de CPF
function mascaraCPF(input) {
    let value = input.value.replace(/\D/g, ''); 
    value = value.replace(/(\d{3})(\d)/, '$1.$2'); 
    value = value.replace(/(\d{3})(\d)/, '$1.$2'); 
    value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2'); 
    input.value = value;
}

// Buscar Email
async function buscarEmail(event) {
    event.preventDefault();

    if (emailBuscado) return; // Se já buscou, não faz nada

    const cpfInput = document.getElementById('cpf');
    const cpf = cpfInput.value.replace(/\D/g, '');
    const emailDisplay = document.getElementById('emailDisplay');
    const spinner = document.getElementById('spinner');

    if (cpf.length !== 11) {
        emailDisplay.textContent = "CPF inválido.";
        return;
    }

    try {
        spinner.style.display = 'block'; // Exibe o spinner
        cpfInput.disabled = true;
        emailDisplay.textContent = "Buscando...";

        // Substitua a URL abaixo pela URL da sua API real
        const response = await fetch(`https://10.30.35.8:8443/rest`, {
            method: 'GET',
            headers: { 'Content-Type': 'application/json' }
        });

        if (!response.ok) throw new Error('Erro na busca do e-mail.');

        const data = await response.json();
        const email = (data.Funcionarios && data.Funcionarios.length > 0) 
                        ? data.Funcionarios[0].Email.trim() 
                        : "Funcionário não encontrado.";

        emailDisplay.textContent = email;
        emailBuscado = true;
    } catch (error) {
        emailDisplay.textContent = "Erro ao buscar e-mail: " + error.message;
    } finally {
        spinner.style.display = 'none';
        cpfInput.disabled = false;
    }
}

// Adiciona o evento de busca ao CPF
document.getElementById('cpf').addEventListener('blur', buscarEmail);

// Foca no campo CPF ao carregar a página
window.onload = () => document.getElementById('cpf').focus();

    </script>
</body>
</html>
